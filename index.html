<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>みとくけん・リアルタイム表示</title>
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    margin: 20px;
    background: #fafafa;
  }
  h1 {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
  }
  .card {
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    background: white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .card h2 {
    margin: 0 0 10px;
    font-size: 20px;
  }
  pre {
    background: #f2f2f2;
    padding: 10px;
    border-radius: 5px;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<h1>みとくけん - リアルタイムモニター</h1>

<!-- ▼ ここに A / B / Ping のカードが自動で挿入される -->

<script type="module">

/* ----------------------------------------------------
   Firebase SDK 読み込み
---------------------------------------------------- */
import { initializeApp } 
  from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getDatabase, ref, onValue }
  from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

/* ----------------------------------------------------
   Firebase 設定（あなたのプロジェクトの値）
---------------------------------------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyA12wibEkdgNQnASN5_gangMQS2OsToGRE",
  authDomain: "segawa-77df6.firebaseapp.com",
  databaseURL: "https://segawa-77df6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "segawa-77df6",
  storageBucket: "segawa-77df6.firebasestorage.app",
  messagingSenderId: "929226250771",
  appId: "1:929226250771:web:1e141ef1faaf71cd749a9",
  measurementId: "G-RLD1RCRG49"
};

// Firebase 初期化
const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

/* ----------------------------------------------------
   UI カード生成
---------------------------------------------------- */
function ensureCard(id, title) {
  let card = document.getElementById(id);
  if (!card) {
    card = document.createElement('div');
    card.id = id;
    card.className = 'card';

    const h = document.createElement('h2');
    h.textContent = title;

    const pre = document.createElement('pre');
    pre.textContent = '（読み込み中…）';

    card.appendChild(h);
    card.appendChild(pre);

    document.body.appendChild(card);
  }
  return card.querySelector('pre');
}

/* A・B・Ping 画面要素を確保 */
const preA   = ensureCard("card-a",   "A デバイス");
const preB   = ensureCard("card-b",   "B デバイス");
const prePing= ensureCard("card-ping","Ping / Liveness");

/* ----------------------------------------------------
   整形用関数
---------------------------------------------------- */
function pretty(v) {
  if (!v) return "（データなし）";
  try {
    const obj = { ...v };
    if (obj.ts) {
      obj.ts_readable = new Date(obj.ts).toLocaleString("ja-JP");
    }
    return JSON.stringify(obj, null, 2);
  } catch (e) {
    return String(v);
  }
}

/* ----------------------------------------------------
   Realtime Database を購読：A
---------------------------------------------------- */
onValue(ref(db, "devices/A"), (snap) => {
  preA.textContent = pretty(snap.val());
});

/* ----------------------------------------------------
   Realtime Database を購読：B
---------------------------------------------------- */
onValue(ref(db, "devices/B"), (snap) => {
  preB.textContent = pretty(snap.val());
});

/* ----------------------------------------------------
   Realtime Database を購読：Ping
---------------------------------------------------- */
onValue(ref(db, "ping"), (snap) => {
  prePing.textContent = pretty(snap.val());
});

</script>

</body>
</html>
